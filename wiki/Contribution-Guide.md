### Setting up Bot Channels Registration

As part of side-loading the app into Teams you will be required to set up a Bot Channels Registration on Azure. Follow this guide [here](https://docs.microsoft.com/en-us/azure/bot-service/bot-service-quickstart-registration?view=azure-bot-service-3.0) to set it up. You will need to use credentials of the Bot Channels Registration to populate the .env file when setting up the project locally.

Once you have created a Bot Channels Registration, go to ‘Channels’ and enable ‘Microsoft Teams’ as one of the channels. This is a crucial step, without this, the Teams app won’t be able to communicate with your webserver.

### Setting up the project locally

1. Clone the Github repo locally
2. Run `npm install` to install all the required folders into node_modules in the command line
3. Add a new .env file in the root directory with the following fields:
   - **Required fields:**
     - HostName – Web address of the server (excluding ‘https://`). Eg. Botframework.azurewebsites.net
     - ApplicationId - Id of the Microsoft Teams application (or of the Bot Framework bot)
     - MicrosoftAppId - App Id for the Bot Framework Bot. Bot Channels Registration ‘Microsoft App Id’
     - MicrosoftAppPassword - App Password for the Bot Framework Bot. Bot Channels Registration ‘Client Secret’
     - MongoDbUri - URI for locally hosted MongoDB database. You can download and set up the Azure Cosmos DB Emulator (MongoDbUri) using this guide and use the given MongoDb URI. You can also set up your own locally hosted MongoDB database.
     - Version – Teams App version. Eg. 1.0.0
     - Port. Eg. 3007
     - DebugMode. Set to `true`
     - Company – Company Name for the Bot Manifest
     - BotDisplayName - Display name of the Bot
   - **Optional:**
     - NGROK_AUTH - NGROK authentication token
     - NGROK_SUBDOMAIN - NGROK sub doman
     - NGROK_REGION - NGROK region
     - ApplicationInsightsInstrumentationKey - Application Insights instrumentation key
     - DefaultMaxRetryCount - Max retry count of retriable failed Cosmos DB (through Mongoose)
     - DefaultMaxWaitTime - Max wait time of retriable failed Cosmos DB (through Mongoose)
     - DefaultRetryAfterMs - Retry interval of retriable failed Cosmos DB (through Mongoose)
     - ExponentialRetryMaxWaitTime - Max retry wait of retriable failed Cosmos DB (through Mongoose) using the Exponential Backoff policy
     - ExponentialRetryAfterMs - Retry interval of retriable failed Cosmos DB (through Mongoose) using the Exponential Backoff policy
4. Get the webserver running
   - After the .env file has been populated with the required variables, do `gulp serve` to run the server locally.
5. Set up tunneling software (NGROK) and update Bot Channels Registration
   - Do `gulp start-ngrok` to open a tunnel to the port in which your web server is running.
   - Use the public URL generated by ngrok to update the `messaging endpoint` on Bot Channels Registration. If the URL generated was ‘abc1234567.ngrok.io’ then update the message endpoint in Bot Channels Registration to ‘abc1234567.ngrok.io/api/messages’.
6. Sideload the App Manifest to Teams
   - After the .env file has been populated with the required variables, do ‘gulp manifest’. This will generate a zip file of in the ‘package’ folder in the root directory.
   - The zip file contains the Teams App Manifest that you can readily sideload. Follow this documentation to sideload the bot to teams.
7. After completing the previous steps including setting up Bot Channels Registration, the Bot should work properly.

### Adding new features:

• Ensure that good coding practices including descriptive comments and unit tests
• Detailed pull request (PR) description including problem statement and how the solution was implemented
• Identify and flag any documentation changes needed in the Wiki section
• Call out what tests were done to verify that the change works and that it didn't break any other functionality (description of test cases)

Once a pull request is made with these changes, the repository owner will comment on any missing info or issues and merge to master once approved.
